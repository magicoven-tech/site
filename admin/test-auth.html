<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMS Admin - Magic Oven</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="../css/main.css">
    <style>
        /* Mantenha todos os estilos do admin/index.html aqui */
    </style>
</head>

<body>
    <div class="vignette-frame"></div>

    <div class="admin-container">
        <div class="admin-header">
            <h1
                style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); font-style: italic; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: var(--spacing-sm);">
                MAGIC OVEN CMS
            </h1>
            <p style="color: var(--color-text-secondary);">Gerenciar Conteúdo</p>
        </div>

        <!-- Verificação de autenticação será feita via JavaScript -->
        <div id="app-content" style="display:none;">
            <!-- Todo o conteúdo do admin aqui -->
        </div>

        <div id="loading-screen" style="text-align: center; padding: 100px 20px;">
            <p style="color: var(--color-text-secondary);">Carregando...</p>
        </div>
    </div>

    <!-- IMPORTANTE: config.js DEVE vir antes -->
    <script src="../js/config.js"></script>
    <script>
        // Verificar autenticação antes de carregar o resto
        async function checkAuthAndInit() {
            try {
                const response = await apiRequest('/api/auth/check');
                const data = await response.json();

                if (!data.authenticated) {
                    // Não autenticado - redireciona para login
                    window.location.href = '/admin/login.html';
                    return;
                }

                // Autenticado - mostra o conteúdo e carrega CMS
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';

                // Carrega o script do CMS Admin
                const script = document.createElement('script');
                script.src = '../js/cms-admin.js';
                document.body.appendChild(script);
            } catch (error) {
                console.error('Erro ao verificar autenticação:', error);
                window.location.href = '/admin/login.html';
            }
        }

        // Executa ao carregar
        checkAuthAndInit();
    </script>
</body>

</html>