<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Auth - Magic Oven</title>
    <link rel="stylesheet" href="../css/main.css">
    <style>
        .debug-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: var(--color-surface-elevated);
            border-radius: 8px;
        }

        .debug-section {
            margin: 20px 0;
            padding: 15px;
            background: var(--color-surface);
            border-radius: 4px;
        }

        .debug-title {
            color: var(--color-accent-primary);
            font-weight: bold;
            margin-bottom: 10px;
        }

        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            color: var(--color-text-primary);
        }

        .btn-test {
            margin: 10px 5px;
        }
    </style>
</head>

<body>
    <div class="vignette-frame"></div>

    <div class="debug-container">
        <h1 style="color: var(--color-accent-primary);">üîç Debug de Autentica√ß√£o</h1>

        <div class="debug-section">
            <div class="debug-title">1. Configura√ß√£o da API</div>
            <pre id="config-info"></pre>
        </div>

        <div class="debug-section">
            <div class="debug-title">2. Cookies Atuais</div>
            <pre id="cookies-info"></pre>
        </div>

        <div class="debug-section">
            <div class="debug-title">3. Teste de Login</div>
            <button class="btn btn-primary btn-test" onclick="testLogin()">Testar Login</button>
            <pre id="login-result"></pre>
        </div>

        <div class="debug-section">
            <div class="debug-title">4. Teste de Verifica√ß√£o de Auth</div>
            <button class="btn btn-primary btn-test" onclick="testAuthCheck()">Verificar Auth</button>
            <pre id="auth-result"></pre>
        </div>

        <div class="debug-section">
            <div class="debug-title">5. Headers da Requisi√ß√£o</div>
            <pre id="headers-info"></pre>
        </div>
    </div>

    <script src="../js/config.js"></script>
    <script>
        // Mostra configura√ß√£o
        document.getElementById('config-info').textContent = JSON.stringify({
            apiBaseURL: API_CONFIG.baseURL,
            currentOrigin: window.location.origin,
            currentHostname: window.location.hostname
        }, null, 2);

        // Mostra cookies
        function showCookies() {
            document.getElementById('cookies-info').textContent =
                document.cookie || 'Nenhum cookie encontrado';
        }
        showCookies();

        // Teste de Login
        async function testLogin() {
            const resultEl = document.getElementById('login-result');
            resultEl.textContent = 'Testando...';

            try {
                const response = await fetch(`${API_CONFIG.baseURL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });

                const data = await response.json();

                resultEl.textContent = JSON.stringify({
                    status: response.status,
                    ok: response.ok,
                    headers: {
                        'set-cookie': response.headers.get('set-cookie'),
                        'access-control-allow-credentials': response.headers.get('access-control-allow-credentials')
                    },
                    data: data
                }, null, 2);

                // Atualiza cookies
                setTimeout(showCookies, 100);
            } catch (error) {
                resultEl.textContent = 'ERRO: ' + error.message + '\n\n' + error.stack;
            }
        }

        // Teste de Verifica√ß√£o
        async function testAuthCheck() {
            const resultEl = document.getElementById('auth-result');
            resultEl.textContent = 'Verificando...';

            try {
                const response = await fetch(`${API_CONFIG.baseURL}/api/auth/check`, {
                    method: 'GET',
                    credentials: 'include'
                });

                const data = await response.json();

                resultEl.textContent = JSON.stringify({
                    status: response.status,
                    ok: response.ok,
                    data: data,
                    cookiesSent: document.cookie
                }, null, 2);
            } catch (error) {
                resultEl.textContent = 'ERRO: ' + error.message;
            }
        }

        // Mostra informa√ß√µes de headers
        document.getElementById('headers-info').textContent = JSON.stringify({
            userAgent: navigator.userAgent,
            cookieEnabled: navigator.cookieEnabled,
            protocol: window.location.protocol
        }, null, 2);
    </script>
</body>

</html>